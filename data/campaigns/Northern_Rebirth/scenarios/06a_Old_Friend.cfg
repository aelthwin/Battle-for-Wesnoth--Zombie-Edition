#textdomain wesnoth-nr
[scenario]
    # Set basic scenario data, music and default time schedule
    id=06a_Old_Friend
    name= _ "Old Friend"
    next_scenario=07a_Settling_Disputes
    turns=18
    {DEFAULT_SCHEDULE}
    map_data="{campaigns/Northern_Rebirth/maps/06a_Old_Friend.map}"

    {INTRO_AND_SCENARIO_MUSIC "loyalists.ogg" "breaking_the_chains.ogg"}
    {EXTRA_SCENARIO_MUSIC "knalgan_theme.ogg"}
    {EXTRA_SCENARIO_MUSIC "wanderer.ogg"}

    # Scenario story, some parts have character portraitsas background
    [story]
        [part]
            story= _ "Laden with gold, and filled with an elation at their victory that was tempered with sadness at the death of their friends, Tallin and his people made their way back to the mines."
        [/part]
        [part]
            story= _ "As they approached they were met with a most welcome sight: New fortifications, looking very much like the legendary impenetrable dwarvish defenses of old, had sprung up everywhere. All of them were manned by alert and well-armed dwarves who hailed them boisterously. The mines were belching smoke from the furiously working forges. New weapons and armor for humans and dwarves alike lay neatly stacked, and the deafening clang of hammers and picks from the dwarves promised more."
        [/part]
        [part]
            story= _ "They found Hamel in a forge hammering away at a new axe. He greeted them warmly and arrangements were quickly made for all their food and accommodations, as wall as care for the sick and wounded."
        [/part]
        [part]
            story= _ "When Tallin’s party had shaken the dust of the road from their clothes, the humans and dwarves once again met in council."
        [/part]
        [part]
            story= _ "It is well, Hamel. Our people prosper."
            background=portraits/Tallin.png
        [/part]
        [part]
            story= _ "Aye. Word ha’ spread, and dwarves who had been living rough in the wilds for fear of the orcs have been coming to join us. Thanks to you, Tallin, Knalga is rising again!"
            background=portraits/Hamel.png
        [/part]
        [part]
            story= _ "We have cleared the connecting tunnels to here and to the old keep as well as other parts o’ Knalga."
            background=portraits/Hamel.png
        [/part]
        [part]
            story= _ "It is slow and dangerous work, mostly due to the trolls. But it ha’ been made easier by Malifor’s ending."
            background=portraits/Hamel.png
        [/part]
        [part]
            story= _ "The lich’s skeletons were fighting the trolls, but when you destroyed him, they all just fell apart. So, there are many tunnels that are now infested with nothing but piles of old bones."
            background=portraits/Hamel.png
        [/part]
        [part]
            story= _ "Great! How about the weapons and armor?"
            background=portraits/Tallin.png
        [/part]
        [part]
            story= _ "As you can see, Tallin, there are muckle heaps of them, all ready to be borne into battle."
            background=portraits/Hamel.png
        [/part]
        [part]
            story= _ "What’s more, some of the dwarves who are expert with the sword, mace and bow, as well as some of yer own men who have grown skilled by experience, can teach others how to wield them."
            background=portraits/Hamel.png
        [/part]
        [part]
            story= _ "I didn’t know that you dwarves knew swordplay. I thought you all fought with axes, hammers or those thunder weapons."
            background=portraits/Tallin.png
        [/part]
        [part]
            # wmllint: local spelling weaponsmiths
            story= _ "Aye, it’s true we do prefer our axes and hammers, but then again, we make swords. We couldna’ claim to be expert weaponsmiths wi’out kenning how to wield the weapons we make."
            background=portraits/Hamel.png
        [/part]
        [part]
            story= _ "There are some dwarves out there that are bonny fighters wi’ a sword as any ye are like to meet. Belike with bows, maces and any other weapons we fashion."
            background=portraits/Hamel.png
        [/part]
        [part]
            story= _ "That’s great! What is the price of your weapons? We have gathered much booty from Malifor’s treasury and we will be able to pay you generously."
            background=portraits/Tallin.png
        [/part]
        [part]
            story= _ "Price?! Don’t insult us, Tallin. Ye have done great things to help the dwarves — it’s because of you that we ha’ made a start rebuilding Knalga in the first place. Dinna’ ye speak of price to us."
            background=portraits/Hamel.png
        [/part]
        [part]
            story= _ "But don’t you need the gold to help rebuild Knalga? And we have plenty."
            background=portraits/Tallin.png
        [/part]
        [part]
            story= _ "Tallin, Knalga was an extremely rich nation. Malifor’s treasury is hardly a fraction of the riches that we will find, and are finding every day now. So nae! Ye’ll need yon gold to rebuild Dwarven Doors."
            background=portraits/Hamel.png
        [/part]
        [part]
            story= _ "Thank you, Hamel."
            background=portraits/Tallin.png
        [/part]
        [part]
            # wmllint: local spelling Pahhh
            story= _ "Pahhh, thank <i>you</i>!"
            background=portraits/Hamel.png
        [/part]
        [part]
            story= _ "And Tallin, one more thing, I have been leading our people into battle for many years now. As a young dwarf I was trained in the arts of leadership and war. There are things you will need to know..."
            background=portraits/Hamel.png
        [/part]
        [part]
            # wmllint: local spelling swingin'
            story= _ "I know you’re impressive wi’ a pitchfork, and you are not half bad with a sword when you choose to use one. But there skills beyond swingin’ a weapon that a general must learn."
            background=portraits/Hamel.png
        [/part]
        [part]
            story= _ "I would be honored, Lord Hamel."
            background=portraits/Tallin.png
        [/part]
        [part]
            story= _ "Ahhhh, quit with the formality, me lad. Now, first things first. One of the most important things about being a leader is...."
            background=portraits/Hamel.png
        [/part]
        [part]
            story= _ "The humans rested for many days while they were equipped with new arms and armor and trained by the dwarves."
        [/part]
        [part]
            story= _ "But the peace was not to last. Early one morning Tallin (sore from head to foot from his training) was startled awake by the blare of trumpets, the pounding of drums and the clash of steel as the humans and dwarves hurried to arm themselves."
        [/part]
        [part]
            story= _ "He sought out Hamel, who informed him that a massive host of orcs had arrived at the gates of the new Knalga."
        [/part]
        [part]
            story= _ "It was decided that Tallin’s men should sally forth to meet the orcs, while Hamel’s held open their retreat into the caves."
        [/part]
    [/story]

    # Players side, capture some villages before the start
    [side]
        type=Peasant
        id=Tallin
        name=_ "Tallin"
        canrecruit=yes
        side=1
        controller=human
        {GOLD4 450 350 300 250}
        recruit=Peasant,Woodsman,Thug,Poacher,Spearman,Bowman,Footpad
        team_name=knalgans
        user_team_name=_"Knalgans"
    [/side]

    {STARTING_VILLAGES 1 4}

    # Computer - main enemy. Note the AI tags, they set the computer to be highly agressive and target tallin
    [side]
        type=Orcish Sovereign
        id=Rakshas
        profile=portraits/Rakshas.png
        name= _ "Rakshas"
        canrecruit=yes
        side=2
        recruit=Orcish Grunt,Orcish Archer,Wolf Rider,Orcish Assassin,Troll Whelp,Orcish Warrior,Orcish Crossbowman,Troll
        {GOLD4 400 500 600 700}
        {INCOME4 30 40 50 60}
        team_name=orcs
        user_team_name=_"Orcs"
        [ai]
            aggression=1.0
            caution=-1.0
            leader_value=50
            passive_leader=yes
        [/ai]
        {FLAG_VARIANT ragged}
    [/side]

    # Sidekicks
    [side]
        type=Orcish Warlord
        id=Drung
        name= _ "Drung"
        canrecruit=yes
        side=3
        recruit=Orcish Grunt,Orcish Archer,Wolf Rider,Orcish Assassin,Troll Whelp,Orcish Warrior,Orcish Crossbowman,Troll
        {GOLD4 400 500 600 700}
        {INCOME4 30 40 50 60}
        team_name=orcs
        user_team_name=_"Orcs"
        [ai]
            aggression=1.0
            caution=-1.0
            leader_value=50
        [/ai]
        {FLAG_VARIANT ragged}
    [/side]

    [side]
        type=Orcish Warlord
        id=Poul
        name= _ "Poul"
        canrecruit=yes
        side=4
        recruit=Orcish Grunt,Orcish Archer,Wolf Rider,Orcish Assassin,Troll Whelp,Orcish Warrior,Orcish Crossbowman,Troll
        {GOLD4 400 500 600 700}
        {INCOME4 30 40 50 60}
        team_name=orcs
        user_team_name=_"Orcs"
        [ai]
            aggression=1.0
            caution=-1.0
            leader_value=50
        [/ai]
        {FLAG_VARIANT ragged}
    [/side]

    # Prestart event, we change Tallin to be of Sergeant line
    [event]
        name=prestart

        # Check his level, and set new type to be a commander of the same level.
        {STORE_UNIT_VAR id=Tallin level old_tallin_level}

        [switch]
            variable=old_tallin_level

            [case]
                value=0
                {VARIABLE new_tallin_type Sergeant}
            [/case]

            [case]
                value=1
                {VARIABLE new_tallin_type Sergeant}
            [/case]

            [case]
                value=2
                {VARIABLE new_tallin_type Lieutenant}
            [/case]

            [else]
                {VARIABLE new_tallin_type General}
            [/else]
        [/switch]

        {TRANSFORM_UNIT id=Tallin $new_tallin_type}
        {FULL_HEAL id=Tallin}

        {CLEAR_VARIABLE old_tallin_level,new_tallin_type}
    [/event]

    # Start event, recall heroes, place some bad guys, set objectives,
    # do the talking
    [event]
        name=start

        # This hack is a workaround for unit roles not getting carried over
        # to next scenario. It may no longer be needed in 1.5 - must test.
        [role]
            [filter_wml]
                [variables]
                    role=Supporter
                [/variables]
            [/filter_wml]
            role=Supporter
        [/role]
        # Recall heroes and a supporter
        [recall]
            role=Supporter
        [/recall]
        [recall]
            id=Camerin
        [/recall]
        [recall]
            id=Abhai
        [/recall]
        [recall]
            id=Krash
        [/recall]
        [recall]
            id=Elenia
        [/recall]
        [recall]
            id=Father Morvin
        [/recall]
        [recall]
            id=Sister Thera
        [/recall]
        # Place bad guy bodyguards
        {NOTRAIT_UNIT 2 "Orcish Warlord" 2 20}
        [+unit]
            ai_special=guardian
        [/unit]
        {NOTRAIT_UNIT 2 "Orcish Warlord" 5 20}
        [+unit]
            ai_special=guardian
        [/unit]
        {NOTRAIT_UNIT 2 "Orcish Warlord" 7 21}
        [+unit]
            ai_special=guardian
        [/unit]
        {NOTRAIT_UNIT 2 "Orcish Warlord" 9 22}
        [+unit]
            ai_special=guardian
        [/unit]
        {NOTRAIT_UNIT 2 "Orcish Warlord" 9 24}
        [+unit]
            ai_special=guardian
        [/unit]
        {NOTRAIT_UNIT 2 "Orcish Warlord" 9 26}
        [+unit]
            ai_special=guardian
        [/unit]
        {NOTRAIT_UNIT 2 "Orcish Warlord" 8 27}
        [+unit]
            ai_special=guardian
        [/unit]
        # Do the talk
        [message]
            id=Rakshas
            message= _ "So I see you stinky-midgets and human-worms finally mustered up the courage to face me."
        [/message]
        [message]
            id=Tallin
            message= _ "Who are you, and what do you want?"
        [/message]
        [message]
            id=Rakshas
            message= _ "I am Emperor Rakshas and by the power of my sword, I lead the orcish people. I am here simply finishing the job Khazg Black-Tusk started years ago — the conquest of Knalga."
        [/message]
        [message]
            id=Tallin
            message= _ "Khazg tried and failed, and if you repeat his folly you will soon join him in the land of the dead!"
        [/message]
        [message]
            id=Rakshas
            # wmllint: local spelling Pah
            message= _ "Pah! I would like to see those cowardly dwarves try their treachery on me as they did on the Black-Tusk! In any case, those dwarves will soon be groveling at my feet and equipping my people with the finest weapons. With the dwarvish weapons, and the wealth of Knalga, nothing will be able to stop us. Even that little backwater that you humans call Wesnoth will be nothing but a burnt out, pillaged wreck before long."
        [/message]
        [message]
            id=Tallin
            message= _ "Boy, this guy sure has delusions of grandeur."
        [/message]
        [message]
            role=Supporter
            message= _ "I am not so sure it’s that simple, Tallin. Think back to those orcs at the Dwarven Doors, and those wolves on the way to the mines; they were both saying something about ‘The Master’."
        [/message]
        [message]
            id=Tallin
            message= _ "Yeah?"
        [/message]
        [message]
            role=Supporter
            message= _ "Well, unless I miss my guess, dreamy fellow would be him."
        [/message]
        [message]
            id=Tallin
            message= _ "Well, if that is so, then it’s time to end this menace once and for all! Fall on them, boys!"
        [/message]
        # Set objectives
        [objectives]
            side=1
            [objective]
                description= _ "Defeat Rakshas, if you can..."
                condition=win
            [/objective]
            [objective]
                description= _ "Or resist till the end of turns"
                condition=win
                show_turn_counter=yes
            [/objective]
            [objective]
                description= _ "Death of Tallin"
                condition=lose
            [/objective]
            note={NO_GOLD_CARRYOVER_NOTE}
        [/objectives]
    [/event]

    # Turn 3, if we didn't employ Russian army tactics yet Tallin gets upset
    [event]
        name=turn 3

        # Store starting point coordinates
        [store_starting_location]
            side=1
            variable=starting_point
        [/store_starting_location]
        # Store coordinates of every unit belonging to side 1 in a radius of 10 hexes from starting point that are not within radius of
        # 5 hexes from starting point.
        [store_locations]
            [filter]
                side=1
            [/filter]
            x=$starting_point.x
            y=$starting_point.y
            range=10
            [not]
                x=$starting_point.x
                y=$starting_point.y
                range=5
            [/not]
            variable=units_attacking
        [/store_locations]
        # Do such units exist?
        [if]
            [variable]
                name=units_attacking.length
                equals=0
            [/variable]
            [then]
                # No, Tallin calls for all out charge. "URRAAA!"
                [message]
                    id=Tallin
                    message= _ "Come on, why are we just sitting here in these caves?! Have you forgotten already all these orcs have done to us! Let us spill their foul blood on the ground!"
                [/message]
            [/then]
        [/if]
        {CLEAR_VARIABLE units_attacking}
        {CLEAR_VARIABLE starting_point}
    [/event]

    # Player somehow breached bad boss cordon, things are going too well, which means we need to throw an army of wolfriders at him
    [event]
        name=moveto
        [filter]
            side=1
            x=1-9
            y=10-27
        [/filter]

        [message]
            id=Rakshas
            message= _ "So! Your forces are managing to advance upon me, are they? Very impressive, but it shall do you no good. KNIGHTS!!"
        [/message]
        # Place 42 Goblin Knights. Yes. Forty-two.
        {NOTRAIT_UNIT 2 "Goblin Knight" 15 17}
        {NOTRAIT_UNIT 2 "Goblin Knight" 15 17}
        {NOTRAIT_UNIT 2 "Goblin Knight" 15 17}
        {NOTRAIT_UNIT 2 "Goblin Knight" 15 17}
        {NOTRAIT_UNIT 2 "Goblin Knight" 15 17}
        {NOTRAIT_UNIT 2 "Goblin Knight" 15 17}
        {NOTRAIT_UNIT 2 "Goblin Knight" 15 17}
        {NOTRAIT_UNIT 2 "Goblin Knight" 15 17}
        {NOTRAIT_UNIT 2 "Goblin Knight" 15 17}
        {NOTRAIT_UNIT 2 "Goblin Knight" 15 17}
        {NOTRAIT_UNIT 2 "Goblin Knight" 15 17}
        {NOTRAIT_UNIT 2 "Goblin Knight" 15 17}
        {NOTRAIT_UNIT 2 "Goblin Knight" 15 17}
        {NOTRAIT_UNIT 2 "Goblin Knight" 11 16}
        {NOTRAIT_UNIT 2 "Goblin Knight" 11 16}
        {NOTRAIT_UNIT 2 "Goblin Knight" 11 16}
        {NOTRAIT_UNIT 2 "Goblin Knight" 11 16}
        {NOTRAIT_UNIT 2 "Goblin Knight" 11 16}
        {NOTRAIT_UNIT 2 "Goblin Knight" 11 16}
        {NOTRAIT_UNIT 2 "Goblin Knight" 11 16}
        {NOTRAIT_UNIT 2 "Goblin Knight" 7 16}
        {NOTRAIT_UNIT 2 "Goblin Knight" 7 16}
        {NOTRAIT_UNIT 2 "Goblin Knight" 7 16}
        {NOTRAIT_UNIT 2 "Goblin Knight" 7 16}
        {NOTRAIT_UNIT 2 "Goblin Knight" 7 16}
        {NOTRAIT_UNIT 2 "Goblin Knight" 7 16}
        {NOTRAIT_UNIT 2 "Goblin Knight" 7 16}
        {NOTRAIT_UNIT 2 "Goblin Knight" 7 16}
        {NOTRAIT_UNIT 2 "Goblin Knight" 7 16}
        {NOTRAIT_UNIT 2 "Goblin Knight" 7 16}
        {NOTRAIT_UNIT 2 "Goblin Knight" 26 22}
        {NOTRAIT_UNIT 2 "Goblin Knight" 26 22}
        {NOTRAIT_UNIT 2 "Goblin Knight" 26 22}
        {NOTRAIT_UNIT 2 "Goblin Knight" 26 22}
        {NOTRAIT_UNIT 2 "Goblin Knight" 26 22}
        {NOTRAIT_UNIT 2 "Goblin Knight" 26 22}
        {NOTRAIT_UNIT 2 "Goblin Knight" 25 26}
        {NOTRAIT_UNIT 2 "Goblin Knight" 25 26}
        {NOTRAIT_UNIT 2 "Goblin Knight" 25 26}
        {NOTRAIT_UNIT 2 "Goblin Knight" 25 26}
        {NOTRAIT_UNIT 2 "Goblin Knight" 25 26}
        {NOTRAIT_UNIT 2 "Goblin Knight" 25 26}

        [message]
            type=Goblin Knight
            message= _ "HAHAHA! GOT YOU, SUCKERS!"
        [/message]
        [message]
            id=Rakshas
            message= _ "CHARGE!!"
        [/message]
        [message]
            id=Tallin
            message= _ "Oh, hell! Form up, men, back to back! Don’t let them penetrate our ranks!"
        [/message]
        [message]
            id=Rakshas
            message= _ "That’s not all, my friends. GENERALS, CALL THE RESERVES!"
        [/message]
        [message]
            id=Drung
            message= _ "Oh yeah!"
        [/message]
        [message]
            id=Poul
            message= _ "HAHAHA!"
        [/message]
        [message]
            id=Drung
            message= _ "You are so dead, you human vermin!"
        [/message]
        [message]
            id=Poul
            message= _ "Oooooooh! Time to start the fun!"
        [/message]
        # And give bad guys 2000 gold each for a good measure. Yes,
        # Taurus is a sadist.
        {VARIABLE reinforcements_side 2}
        [while]
            [variable]
                name=reinforcements_side
                less_than=5
            [/variable]
            [do]
                [gold]
                    side=$reinforcements_side
                    amount=2000
                [/gold]
                {VARIABLE_OP reinforcements_side add 1}
            [/do]
        [/while]
        {CLEAR_VARIABLE reinforcements_side}
        [message]
            role=Supporter
            message= _ "This doesn’t look good..."
        [/message]
    [/event]

    # Sidekick death event, 500g to player and 500 to each enemy
    [event]
        name=last breath
        [filter]
            id=Drung
        [/filter]

        [message]
            id=Drung
            message= _ "Argh! I have been slain!"
        [/message]
        [message]
            speaker=second_unit
            message= _ "Killed him! Got his gold too. Lets see, hmmm, about 500 gold pieces. Not bad."
        [/message]
        [gold]
            side=1
            amount=512
        [/gold]
        [message]
            id=Rakshas
            message= _ "They have killed one of my generals! REINFORCEMENTS!"
        [/message]
        {VARIABLE reinforcements_side 2}
        [while]
            [variable]
                name=reinforcements_side
                less_than=5
            [/variable]
            [do]
                [gold]
                    side=$reinforcements_side
                    amount=500
                [/gold]
                {VARIABLE_OP reinforcements_side add 1}
            [/do]
        [/while]
        {CLEAR_VARIABLE reinforcements_side}
    [/event]

    # As above
    [event]
        name=last breath
        [filter]
            id=Poul
        [/filter]

        [message]
            id=Poul
            message= _ "My death will only make the Master’s punishment for you worse, you fools!"
        [/message]
        [message]
            speaker=second_unit
            message= _ "Your death makes your Master’s punishment from us one step closer!"
        [/message]
        [message]
            speaker=second_unit
            message= _ "But— my my, what’s in that big pouch? 300 gold! Not bad."
        [/message]
        [gold]
            side=1
            amount=302
        [/gold]
        [message]
            id=Rakshas
            message= _ "You vermin will pay for that! REINFORCEMENTS!"
        [/message]
        {VARIABLE reinforcements_side 2}
        [while]
            [variable]
                name=reinforcements_side
                less_than=5
            [/variable]
            [do]
                [gold]
                    side=$reinforcements_side
                    amount=500
                [/gold]
                {VARIABLE_OP reinforcements_side add 1}
            [/do]
        [/while]
        {CLEAR_VARIABLE reinforcements_side}
    [/event]

    # A miracle happened. Bad boss died. Player won.
    [event]
        name=last breath
        [filter]
            id=Rakshas
        [/filter]

        [message]
            id=Rakshas
            message= _ "Ahhhh! Run for your life!"
        [/message]
        [message]
            speaker=second_unit
            message= _ "What the... Hey, where do you think you are running off to, you coward!"
        [/message]
        [message]
            id=Tallin
            message= _ "Stop him!"
        [/message]
        [message]
            speaker=second_unit
            message= _ "It’s too late! I am sorry, Tallin, he got away! We did not expect he would flee like a coward."
        [/message]
        [message]
            id=Tallin
            message= _ "Damn! We had the opportunity to end the war in one stroke there. Now we will have to go after him, assuming we can break this siege!"
        [/message]
    [/event]

    # Time over. Player didn't kill the bad guy but still survived, and that's also a victory.
    [event]
        name=time over

        [message]
            id=Tallin
            # wmllint: local spelling Geez
            message= _ "Geez, we have been fighting them for three whole days and nights now with no end in sight. Now the fourth night is approaching, what should we do?"
        [/message]
        [message]
            id=Father Morvin
            message= _ "It seems hopeless to continue on like this. The orcs’ numbers are unlimited and Rakshas is very well guarded. The only possible outcome to all this is more slaughter."
        [/message]
        [message]
            id=Sister Thera
            message= _ "I propose that we retreat back into the caves and consult with the dwarves."
        [/message]
        [message]
            role=Supporter
            message= _ "I agree, Tallin, it is pointless to carry on."
        [/message]
        [message]
            id=Tallin
            message= _ "Very well. Everyone fall back!"
        [/message]
        [message]
            id=Camerin
            message= _ "Awwwww! Just when I was having the most fun!"
        [/message]
        [endlevel]
            result=victory
            bonus=no
        [/endlevel]
    [/event]

    # And load the standard death events.
    {campaigns/Northern_Rebirth/utils/herodeaths.cfg}
[/scenario]
